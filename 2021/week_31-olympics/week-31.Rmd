---
title: "week-31"
author: "Maxwel Coura Oliveira"
date: "7/27/2021"
output: html_document
---




```{r}
olympics <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-07-27/olympics.csv')
```



```{r}
library(tidyverse)
library(ggflags)
library(ggthemes)
library(ggtext)
library(countrycode)
```

```{r}
# data with country and continents
mobile <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-11-10/mobile.csv') %>% 
  dplyr::select(entity, continent) %>% 
  filter(continent == "Americas") -> country
```


```{r}
country %>% 
  left_join(olympics, by = c("entity" = "team")) %>% 
  filter(!entity %in% c("United States", "Canada") & 
           season == "Summer") %>% 
  filter(!is.na(medal)) %>% 
  distinct(entity, games, event, medal) %>% 
  count(entity, medal) -> latin_am
```


```{r}
latin_am %>% 
  pivot_wider(id_cols = entity, names_from = medal, values_from = n) %>% 
  mutate_at(c("Bronze", "Gold", "Silver"), ~ replace_na(., 0)) %>% 
  mutate(Total = Gold + Silver + Bronze) %>% 
  group_by(entity) %>% 
  arrange(desc(Gold)) %>%
  ungroup(entity) %>%
  mutate(Rank = row_number()) -> latin_am1
```






  
```{r}
latin_am1 %>% 
#  bind_cols(flag_country) %>% 
  pivot_longer(c("Gold", "Silver", "Bronze"), 
               names_to = "medal", 
               values_to = "n") %>% 
  dplyr::select(Rank, entity, medal, n, Total) %>% 
  rename(Country = entity) -> latin_am2
```

```{r}
flags <- latin_am2 %>% 
  pull(Country) 

countrycode(flags, 'country.name', 'iso2c') %>% 
  as_tibble() %>% 
  rename(flag = value) %>% 
  mutate(flag = str_to_lower(flag)) -> flags1
```

```{r}
latin_am2 %>% 
  bind_cols(flags1) %>% 
  mutate(Country = fct_recode(Country,
       "US Virgin Islands" = "United States Virgin Islands")) -> latin_am3
```



```{r}
library(extrafont)
library(showtext)
showtext_auto()
font_add_google("Lato", "lato") 
font_add_google("Play", "play") 
```





```{r}
latin_am3 %>% 
  ggplot(aes(x = Rank, y = n, 
           country = flag)) +
  geom_point(latin_am3 %>% 
               filter(medal == "Gold"), 
             mapping = aes(y = 45), 
             size = 10, 
             color = "gold", 
             show.legend = FALSE) +
  geom_text(latin_am3 %>% 
               filter(medal == "Gold"),
            mapping = aes(label = n, y = 45), 
            fontface = "bold") +
  geom_point(latin_am3 %>% 
               filter(medal == "Silver"), 
             mapping = aes(y = 55), 
             size = 10, color = "#d6d6d6", 
             show.legend = FALSE) +
  geom_text(latin_am3 %>% 
               filter(medal == "Silver"),
            mapping = aes(label = n, y = 55),
            fontface = "bold") +
  geom_point(latin_am3 %>% 
               filter(medal == "Bronze"), 
                      mapping = aes(y = 65), 
             size = 10, 
             color = "#cd7f32", 
             show.legend = FALSE) +
  geom_text(latin_am3 %>% 
               filter(medal == "Bronze"),
            mapping = aes(label = n, y = 65),
            fontface = "bold") +
  coord_flip() +
  scale_x_reverse() +
  scale_y_continuous(limits = c(5, 70)) -> fig1
```

```{r}
symbol_ol <- "<img src='https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Olympic_rings_without_rims.svg/2560px-Olympic_rings_without_rims.svg.png' width='50'/>"
```


```{r}
fig1 + 
  geom_richtext(latin_am3 %>% 
              group_by(Country) %>% 
              filter(n == min(n)),
              mapping = aes(y = 30, label = Country),
            hjust = 1, size = 6, label.color = NA) +
  geom_flag(latin_am3 %>% 
              group_by(Country) %>% 
              filter(n == min(n)),
            mapping = aes(y = 33), hjust = 1, size = 7) +
  labs(x = NULL, y = NULL,
       title = "Latin America summer Olympics medals",
       subtitle = symbol_ol,
       caption = "Data from Athens 1896 to Rio 2016 | Source: Kaggle | Figure: @maxwelco") + 
   theme_void(base_family = "lato") +
   theme(axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.y = element_blank(),
        panel.grid.minor = element_blank(),
        plot.caption = element_markdown(hjust = 0.5,
                                        color = "gray60",
                                        size = 11),
        plot.subtitle = element_markdown(hjust = 0.5,
                                         margin=margin(0,0,-5,0)),
        plot.title = element_markdown(family = "play", 
                                      face = "bold",
                                      size = 20, 
                                      hjust = 0.5)) 

ggsave("fig.png", bg = "white", height = 12)
```






